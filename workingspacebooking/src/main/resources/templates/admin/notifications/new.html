<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin_layout}">
<head>
    <meta charset="UTF-8">
</head>
<body th:with="pageTitle=#{notification.form.title}">
<div layout:fragment="content">
    <h2 th:text="#{notification.form.title}">Send System Notification</h2>
    <hr class="text-secondary">

    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}">
    </div>

    <form th:action="@{/admin/notifications}" th:object="${request}" method="post">
        <div class="mb-3">
            <label for="title" class="form-label" th:text="#{notification.form.title.label} + ' *'">Title *</label>
            <input type="text" 
                   class="form-control" 
                   th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''"
                   id="title" 
                   th:field="*{title}" 
                   th:placeholder="#{notification.form.title.placeholder}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">
            </div>
        </div>

        <div class="mb-3">
            <label for="content" class="form-label" th:text="#{notification.form.content.label} + ' *'">Content *</label>
            <textarea class="form-control" 
                      th:classappend="${#fields.hasErrors('content')} ? 'is-invalid' : ''"
                      id="content" 
                      th:field="*{content}" 
                      rows="5" 
                      th:placeholder="#{notification.form.content.placeholder}"></textarea>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">
            </div>
        </div>

        <div class="mb-3">
            <label for="type" class="form-label" th:text="#{notification.form.type.label} + ' *'">Notification Type *</label>
            <select class="form-select" 
                    th:classappend="${#fields.hasErrors('type')} ? 'is-invalid' : ''"
                    id="type" 
                    th:field="*{type}">
                <option value="" th:text="#{notification.form.type.select.option}">-- Select notification type --</option>
                <option th:each="notificationType : ${notificationTypes}" 
                        th:value="${notificationType}" 
                        th:text="${notificationType == T(naitei.group5.workingspacebooking.entity.enums.NotificationType).EMERGENCY} ? #{notification.type.emergency} : 
                                 (${notificationType == T(naitei.group5.workingspacebooking.entity.enums.NotificationType).MAINTENANCE} ? #{notification.type.maintenance} : #{notification.type.policy.update})">
                </option>
            </select>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('type')}" th:errors="*{type}">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label" th:text="#{notification.form.target.roles.label} + ' *'">Recipient Roles *</label>
            <div class="form-check" th:each="userRole : ${userRoles}">
                <input class="form-check-input" 
                       type="checkbox" 
                       th:field="*{targetRoles}" 
                       th:value="${userRole}"
                       th:id="${'targetRoles_' + userRole}">
                <label class="form-check-label" 
                       th:for="${'targetRoles_' + userRole}"
                       th:text="${userRole == T(naitei.group5.workingspacebooking.entity.enums.UserRole).admin} ? #{user.role.admin} : 
                                (${userRole == T(naitei.group5.workingspacebooking.entity.enums.UserRole).renter} ? #{user.role.renter} : 
                                (${userRole == T(naitei.group5.workingspacebooking.entity.enums.UserRole).owner} ? #{user.role.owner} : #{user.role.pending.owner}))">
                </label>
            </div>
            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('targetRoles')}" th:errors="*{targetRoles}">
            </div>
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> <span th:text="#{notification.form.button.send}">Send Now</span>
            </button>
            <a th:href="@{/admin/dashboard}" class="btn btn-secondary ms-2">
                <i class="fas fa-arrow-left"></i> <span th:text="#{notification.form.button.back}">Back</span>
            </a>
        </div>
    </form>
</div>
</body>
</html>
