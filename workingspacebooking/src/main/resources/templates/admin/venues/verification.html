<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin_layout}">
<head>
    <meta charset="UTF-8">
</head>
<body th:with="pageTitle=#{venue.verification.title}">
<div layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 th:text="#{venue.verification.title}">Xác thực Co-Working Space</h2>
        <a th:href="@{/admin/venues}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i><span th:text="#{venue.back.to.list}">Quay về danh sách Co-working space</span>
        </a>
    </div>
    <hr class="text-secondary">
    
    <!-- Flash Messages -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <!-- Filter Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" th:action="@{/admin/venues/verification}">
                <div class="row">
                    <div class="col-md-3">
                        <label for="status" class="form-label" 
                               th:text="#{venue.admin.filter.status}">Status</label>
                        <select class="form-control" id="status" name="status">
                            <option value="all" 
                                    th:selected="${currentStatus == 'all'}"
                                    th:text="#{venue.verification.filter.all}">Tất cả</option>
                            <option value="unverified" 
                                    th:selected="${currentStatus == null or currentStatus == '' or currentStatus == 'unverified'}"
                                    th:text="#{venue.verification.filter.unverified}">Chưa duyệt</option>
                            <option value="verified" 
                                    th:selected="${currentStatus == 'verified'}"
                                    th:text="#{venue.verification.filter.verified}">Đã duyệt</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="size" class="form-label" th:text="#{venue.pagination.perpage}">Hiển thị/trang</label>
                        <select class="form-control" id="size" name="size">
                            <option value="20" th:selected="${currentSize == 20}" th:text="20">20</option>
                            <option value="50" th:selected="${currentSize == 50}" th:text="50">50</option>
                            <option value="100" th:selected="${currentSize == 100}" th:text="100">100</option>
                            <option value="-1" th:selected="${currentSize == -1}" th:text="#{venue.pagination.all}">Tất cả</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" th:text="#{common.filter}">Filter</button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-grid gap-2">
                            <a th:href="@{/admin/venues/verification}" class="btn btn-secondary" th:text="#{common.reset}">Reset</a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Results Table -->
    <table class="table table-striped table-light text-dark align-middle">
        <thead>
            <tr>
                <th>#</th>
                <th th:text="#{common.name}">Name</th>
                <th th:text="#{venue.column.owner}">Owner</th>
                <th th:text="#{venue.column.capacity}">Capacity</th>
                <th th:text="#{venue.column.location}">Location</th>
                <th th:text="#{venue.column.style}">Style</th>
                <th th:text="#{venue.column.status}">Status</th>
                <th th:text="#{common.actions}">Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="venueView, iterStat : ${isShowAll ? venues : venues.content}">
                <td th:text="${iterStat.count}">1</td>
                <td th:text="${venueView.venue.name}">Venue Name</td>
                <td th:text="${venueView.ownerName}">Owner Name</td>
                <td th:text="${venueView.venue.capacity}">100</td>
                <td th:text="${venueView.venue.location}">Location</td>
                <td th:text="${venueView.venue.venueStyleName ?: 'N/A'}">Style</td>
                <td>
                    <span th:if="${venueView.deleted}" 
                          class="badge bg-danger" 
                          th:text="#{venue.status.deleted}">Deleted</span>
                    <span th:if="${!venueView.deleted and venueView.venue.verified}" 
                          class="badge bg-success" 
                          th:text="#{venue.status.verified}">Verified</span>
                    <span th:if="${!venueView.deleted and !venueView.venue.verified}" 
                          class="badge bg-warning text-dark" 
                          th:text="#{venue.status.unverified}">Unverified</span>
                </td>
                <td>
                    <!-- Single Actions -->
                    <div th:if="${!venueView.deleted}">
                        <form th:if="${!venueView.venue.verified}" 
                              th:action="@{/admin/venues/{id}/approve(id=${venueView.venue.id})}" 
                              method="post" class="d-inline-form">
                            <input type="hidden" name="_method" value="patch">
                            <input type="hidden" name="status" th:value="${currentStatus}">
                            <input type="hidden" name="page" th:value="${currentPage}">
                            <input type="hidden" name="size" th:value="${currentSize}">
                            <button type="submit" class="btn btn-sm btn-success" 
                                    th:text="#{venue.action.approve}">Duyệt</button>
                        </form>
                        <form th:if="${venueView.venue.verified}" 
                              th:action="@{/admin/venues/{id}/unverify(id=${venueView.venue.id})}" 
                              method="post" class="d-inline-form">
                            <input type="hidden" name="_method" value="patch">
                            <input type="hidden" name="status" th:value="${currentStatus}">
                            <input type="hidden" name="page" th:value="${currentPage}">
                            <input type="hidden" name="size" th:value="${currentSize}">
                            <button type="submit" class="btn btn-sm btn-warning" 
                                    th:text="#{venue.action.unverify}">Bỏ duyệt</button>
                        </form>
                    </div>
                </td>
            </tr>
            <tr th:if="${isShowAll ? #lists.isEmpty(venues) : venues.empty}">
                <td colspan="8" class="text-center text-muted" th:text="#{venue.table.empty}">No venues found</td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination -->
    <div th:if="${!isShowAll and venues.totalPages > 1}" class="d-flex justify-content-center mt-4">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <!-- Previous Page -->
                <li class="page-item" th:classappend="${venues.first} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/admin/venues/verification(status=${currentStatus}, page=${venues.number - 1}, size=${currentSize})}"
                       th:unless="${venues.first}" th:text="#{pagination.previous}">‹ Previous</a>
                    <span class="page-link text-muted" th:if="${venues.first}" th:text="#{pagination.previous}">‹ Previous</span>
                </li>

                <!-- Page Numbers -->
                <li th:each="pageNum : ${#numbers.sequence(0, venues.totalPages - 1)}"
                    th:if="${pageNum >= (venues.number - 2) and pageNum <= (venues.number + 2)}"
                    class="page-item"
                    th:classappend="${pageNum == venues.number} ? 'active'">
                    <a class="page-link" 
                       th:href="@{/admin/venues/verification(status=${currentStatus}, page=${pageNum}, size=${currentSize})}"
                       th:text="${pageNum + 1}">1</a>
                </li>

                <!-- Next Page -->  
                <li class="page-item" th:classappend="${venues.last} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/admin/venues/verification(status=${currentStatus}, page=${venues.number + 1}, size=${currentSize})}"
                       th:unless="${venues.last}" th:text="#{pagination.next}">Next ›</a>
                    <span class="page-link text-muted" th:if="${venues.last}" th:text="#{pagination.next}">Next ›</span>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Show pagination info -->
    <div th:if="${!isShowAll}" class="d-flex justify-content-center mt-2 text-muted">
        <small th:text="#{venue.pagination.info(${venues.numberOfElements}, ${venues.totalElements})}">
            Showing 10 of 25 venues
        </small>
    </div>
</div>

</body>
</html>
