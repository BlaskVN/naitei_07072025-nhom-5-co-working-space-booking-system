<!-- templates/admin/users/user-list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin_layout}">
<head>
    <meta charset="UTF-8">
</head>
<body th:with="pageTitle='Quản lý người dùng'">
<div layout:fragment="content">
    <h2>Quản lý người dùng</h2>
    <hr class="text-secondary">

    <!-- Hiển thị message -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Filter form -->
    <form method="get" class="row g-3 mb-3">
        <div class="col-auto">
            <label for="role" class="form-label">Lọc theo vai trò:</label>
            <select id="role" name="role" class="form-select">
                <option value="" th:selected="${selectedRole == null}">Tất cả vai trò</option>
                <option th:each="r : ${roles}"
                        th:value="${r}"
                        th:text="${r.name()}"
                        th:selected="${selectedRole == r}">
                </option>
            </select>
        </div>
        <div class="col-auto d-flex align-items-end">
            <button type="submit" class="btn btn-primary">Lọc</button>
        </div>
    </form>

    <table class="table table-striped table-light text-dark align-middle">
        <thead>
        <tr>
            <th>#</th>
            <th>Tên</th>
            <th>Email</th>
            <th>Vai trò</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user, iterStat : ${users}">
            <td th:text="${iterStat.index + 1}">1</td>
            <td th:text="${user.name}">Nguyễn Văn A</td>
            <td th:text="${user.email}">a@example.com</td>
            <td th:text="${user.role}">ADMIN</td>
            <td>
                <!-- Chỉ hiển thị khi role = pending_owner -->
                <form th:if="${user.role.name() == 'pending_owner'}"
                      th:action="@{'/admin/users/' + ${user.id} + '/approve-owner'}"
                      method="post"
                      style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm">Xác thực</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
